
# Etalon Notificator
Это приложение позволяет отправлять электронные письма через SMTP-сервер с возможностью добавления вложений.


## Установка

Шаги для установки и использования приложения:

1.  Склонируйте репозиторий:
```bash
git clone https://github.com/ds24-ru/etalon-notificator.git
```

2. Установите зависимости с помощью команды:
```bash
npm install
```

3. Создайте файл `config.js` на основе `config.example.js` и заполните все поля данными для вашего SMTP-сервера и токеном авторизации.

Для использования настроек почты в вашем приложении вам нужно заполнить следующие переменные в файле `config.js`:

-   `user`: электронный адрес, который будет использоваться для отправки писем
-   `pass`: пароль для доступа к указанному электронному адресу
-   `port`: порт, на котором будет запущен сервер
-   `secret`: секретный ключ для авторизации запросов к серверу
-   `host`: хост сервера электронной почты
-   `transport_port`: порт сервера электронной почты
-   `secure`: логический параметр, указывающий на необходимость использования защищенного соединения SSL/TLS.
-   `pool`: булево значение, которое указывает, будет ли создан пул соединений для отправки писем (если значение `true`, то будет создан пул соединений, если `false`, то каждое соединение будет создаваться заново при отправке письма)
-   `maxConnections`: максимальное количество соединений, которое будет создано в пуле
-   `maxMessages`: максимальное количество сообщений, которое может быть отправлено одним соединением (если значение `Infinity`, то отправка не будет прерываться по достижении лимита сообщений)

Пример заполнения этих переменных в конфигурационном файле `config.example.js`:
```js
module.exports = {
    port: 5554,
    secret: 'mysecretkey',
    host: 'your-host',
    transport_port: 587,
    secure: true,
    pool: true,
    maxConnections: 10,
    maxMessages: Infinity,
    user: 'example@gmail.com',
    pass: 'mysecretpassword'
};
```

4. Запустите приложение с помощью команды:
```bash
npm run dev
```

5. Для запуска приложения в продакшн среде, рекомендуется использовать менеджер процессов [PM2](https://pm2.keymetrics.io/):
```bash
pm2 start app.js -i max
```

## Использование

1. Отправьте POST-запрос на `http://localhost:5554/email` (или ваш собственный хост) с JSON-телом запроса вида:
```json
{
  "transport": "your-transport-seervice",
  "to": "recipient@example.com",
  "subj": "Тестовое письмо",
  "text": "Это тестовое письмо.",
  "html": "<p>Это тестовое письмо.</p>"
}
```

Параметры запроса: -  
`transport` - название SMTP-транспорта, который указан в `config`,

 `to` - адрес получателя письма ,

 `subj` - тема письма ,

 `text` или  `html` - тело письма,

 `attachments` - список прикрепленных файлов

2.  Добавьте заголовок `Authorization` с токеном авторизации в формате `Bearer <token>`. Этот `token` будет сверяться с переменной `secret` из вашего `config.js` файла и проводить валидацию запроса.

<code>Для тестирования с помощью <b>curl</b></code>
  
3. Добавьте заголовок типа: `-H "Content-Type: application/json"`

Пример запроса:
```bash
curl -X POST -H "Content-Type: application/json" -H "Authorization: Bearer SECRET_TOKEN" -d '{
"transport": "etalon",
"to": "RECEPIENT",
"subj": "Тестовое письмо",
"text": "Hello from Curl!",
"html": "<h1>Hello from Curl!</h1>"
}' HOST
```
Где:
`SECRET_TOKEN` - секрет из вашего файла `config.js`
`RECEPIENT` -  email-адрес получателя сообщения 
`HOST` - адрес хоста сервиса отправки email. (например, `http://localhost:5554/email`)

<code>Для тестирования с помощью <b>Postman</b></code>

3.  Нажмите кнопку "Send" и проверьте результат. Если все прошло успешно, вы получите сообщение об успешной отправке письма. Если возникла ошибка, вы получите соответствующее сообщение об ошибке.
 